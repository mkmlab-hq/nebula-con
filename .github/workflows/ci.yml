# .github/workflows/ci.yml
# NebulaCon CI: 첫 자동화 부대의 견고한 토대
#
# - 현재는 구조 검증에 집중, 미래엔 Python 품질검사로 확장
# - 각 단계에 설명 추가, 실패 시 GitHub Actions Summary에도 원인 기록

name: NebulaCon CI

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]
  workflow_dispatch:

jobs:
  structure-check:
    name: "🧱 Repository Structure Check"
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@v4

      - name: 📂 Verify essential directories
        id: structure
        shell: bash
        run: |
          echo "🔎 필수 디렉토리 검사 시작..."
          dirs=(docs scripts sql)
          missing=()
          for d in "${dirs[@]}"; do
            if [ ! -d "$d" ]; then
              echo "::error title=구조 오류::❌ 필수 디렉토리 '$d'가 없습니다."
              missing+=("$d")
            else
              echo "  - ✅ $d 디렉토리 존재"
            fi
          done

          if [ "${#missing[@]}" -ne 0 ]; then
            echo "필수 디렉토리 누락: ${missing[*]}" >> $GITHUB_STEP_SUMMARY
            exit 1
          else
            echo "모든 필수 디렉토리가 존재합니다." >> $GITHUB_STEP_SUMMARY
          fi
          echo "구조 검사 완료."

  # --- 아래는 코드 추가 시 주석 해제하여 확장 가능 ---
  # python-ci:
  #   name: "🐍 Python CI"
  #   needs: structure-check
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: 📥 Checkout repository
  #       uses: actions/checkout@v4
  #
  #     - name: 🐍 Set up Python 3.11
  #       uses: actions/setup-python@v5
  #       with:
  #         python-version: '3.11'
  #
  #     - name: 📦 Install dependencies
  #       run: |
  #         python -m pip install --upgrade pip
  #         if [ -f requirements.txt ]; then pip install -e ".[dev]"; fi
  #
  #     - name: 🧹 Lint with Ruff
  #       run: |
  #         pip install ruff
  #         ruff check .
  #
  #     - name: 🧪 Run tests with Pytest
  #       run: |
  #         pip install pytest pytest-cov
  #         pytest --maxfail=3 --disable-warnings --cov=.
